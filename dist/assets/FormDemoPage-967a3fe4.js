import{s as Ee,ad as H,d as N,aw as Ie,an as re,i as u,a5 as z,a6 as K,ac as O,aU as oe,ak as Y,aP as Ce,aQ as ke,aK as Pe,aV as Be,aW as Te,al as D,av as Me,ag as Ae,a7 as Fe,r as Le,x as q,aE as Re,m as C,aX as ee,X as $e,aY as Oe,a1 as De,am as R,ao as qe,ae as ze,ai as k,aZ as te,a_ as Ne,au as j,V as ie,a0 as se,a$ as We,F as Ue,b0 as je,b as Ge,c as Ke,w as $,_ as He}from"./index-e227146f.js";import{B as Ye}from"./index-75b16952.js";import{c as Xe,C as Je,u as Qe}from"./index-982e4c9d.js";let Ze=0;function et(){const e=Ee(),{name:n="unknown"}=(e==null?void 0:e.type)||{};return`${n}-${++Ze}`}const[tt,nt]=H("form"),at={colon:Boolean,disabled:Boolean,readonly:Boolean,required:[Boolean,String],showError:Boolean,labelWidth:z,labelAlign:String,inputAlign:String,scrollToError:Boolean,scrollToErrorPosition:String,validateFirst:Boolean,submitOnEnter:K,showErrorMessage:K,errorMessageAlign:String,validateTrigger:{type:[String,Array],default:"onBlur"}};var lt=N({name:tt,props:at,emits:["submit","failed"],setup(e,{emit:n,slots:s}){const{children:r,linkChildren:l}=Ie(oe),c=a=>a?r.filter(d=>a.includes(d.name)):r,E=a=>new Promise((d,g)=>{const V=[];c(a).reduce((U,B)=>U.then(()=>{if(!V.length)return B.validate().then(T=>{T&&V.push(T)})}),Promise.resolve()).then(()=>{V.length?g(V):d()})}),x=a=>new Promise((d,g)=>{const V=c(a);Promise.all(V.map(b=>b.validate())).then(b=>{b=b.filter(Boolean),b.length?g(b):d()})}),f=a=>{const d=r.find(g=>g.name===a);return d?new Promise((g,V)=>{d.validate().then(b=>{b?V(b):g()})}):Promise.reject()},w=a=>typeof a=="string"?f(a):e.validateFirst?E(a):x(a),v=a=>{typeof a=="string"&&(a=[a]),c(a).forEach(g=>{g.resetValidation()})},W=()=>r.reduce((a,d)=>(a[d.name]=d.getValidationStatus(),a),{}),P=(a,d)=>{r.some(g=>g.name===a?(g.$el.scrollIntoView(d),!0):!1)},M=()=>r.reduce((a,d)=>(d.name!==void 0&&(a[d.name]=d.formValue.value),a),{}),A=()=>{const a=M();w().then(()=>n("submit",a)).catch(d=>{n("failed",{values:a,errors:d});const{scrollToError:g,scrollToErrorPosition:V}=e;g&&d[0].name&&P(d[0].name,V?{block:V}:void 0)})},I=a=>{O(a),A()};return l({props:e}),re({submit:A,validate:w,getValues:M,scrollToField:P,resetValidation:v,getValidationStatus:W}),()=>{var a;return u("form",{class:nt(),onSubmit:I},[(a=s.default)==null?void 0:a.call(s)])}}});const rt=Y(lt);function ue(e){return Array.isArray(e)?!e.length:e===0?!1:!e}function ot(e,n){if(ue(e)){if(n.required)return!1;if(n.validateEmpty===!1)return!0}return!(n.pattern&&!n.pattern.test(String(e)))}function it(e,n){return new Promise(s=>{const r=n.validator(e,n);if(Be(r)){r.then(s);return}s(r)})}function ne(e,n){const{message:s}=n;return Te(s)?s(e,n):s||""}function st({target:e}){e.composing=!0}function ae({target:e}){e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}function ut(e,n){const s=Ce();e.style.height="auto";let r=e.scrollHeight;if(Pe(n)){const{maxHeight:l,minHeight:c}=n;l!==void 0&&(r=Math.min(r,l)),c!==void 0&&(r=Math.max(r,c))}r&&(e.style.height=`${r}px`,ke(s))}function ct(e){return e==="number"?{type:"text",inputmode:"decimal"}:e==="digit"?{type:"tel",inputmode:"numeric"}:{type:e}}function p(e){return[...e].length}function G(e,n){return[...e].slice(0,n).join("")}const[dt,S]=H("field"),ft={id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:z,formatter:Function,clearIcon:D("clear"),modelValue:Me(""),inputAlign:String,placeholder:String,autocomplete:String,autocapitalize:String,autocorrect:String,errorMessage:String,enterkeyhint:String,clearTrigger:D("focus"),formatTrigger:D("onChange"),spellcheck:{type:Boolean,default:null},error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null}},mt=Ae({},Xe,ft,{rows:z,type:D("text"),rules:Array,autosize:[Boolean,Object],labelWidth:z,labelClass:Fe,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}});var gt=N({name:dt,props:mt,emits:["blur","focus","clear","keypress","clickInput","endValidate","startValidate","clickLeftIcon","clickRightIcon","update:modelValue"],setup(e,{emit:n,slots:s}){const r=et(),l=Le({status:"unvalidated",focused:!1,validateMessage:""}),c=q(),E=q(),x=q(),{parent:f}=Re(oe),w=()=>{var t;return String((t=e.modelValue)!=null?t:"")},v=t=>{if(k(e[t]))return e[t];if(f&&k(f.props[t]))return f.props[t]},W=C(()=>{const t=v("readonly");if(e.clearable&&!t){const o=w()!=="",i=e.clearTrigger==="always"||e.clearTrigger==="focus"&&l.focused;return o&&i}return!1}),P=C(()=>x.value&&s.input?x.value():e.modelValue),M=C(()=>{var t;const o=v("required");return o==="auto"?(t=e.rules)==null?void 0:t.some(i=>i.required):o}),A=t=>t.reduce((o,i)=>o.then(()=>{if(l.status==="failed")return;let{value:m}=P;if(i.formatter&&(m=i.formatter(m,i)),!ot(m,i)){l.status="failed",l.validateMessage=ne(m,i);return}if(i.validator)return ue(m)&&i.validateEmpty===!1?void 0:it(m,i).then(h=>{h&&typeof h=="string"?(l.status="failed",l.validateMessage=h):h===!1&&(l.status="failed",l.validateMessage=ne(m,i))})}),Promise.resolve()),I=()=>{l.status="unvalidated",l.validateMessage=""},a=()=>n("endValidate",{status:l.status,message:l.validateMessage}),d=(t=e.rules)=>new Promise(o=>{I(),t?(n("startValidate"),A(t).then(()=>{l.status==="failed"?(o({name:e.name,message:l.validateMessage}),a()):(l.status="passed",o(),a())})):o()}),g=t=>{if(f&&e.rules){const{validateTrigger:o}=f.props,i=te(o).includes(t),m=e.rules.filter(h=>h.trigger?te(h.trigger).includes(t):i);m.length&&d(m)}},V=t=>{var o;const{maxlength:i}=e;if(k(i)&&p(t)>+i){const m=w();if(m&&p(m)===+i)return m;const h=(o=c.value)==null?void 0:o.selectionEnd;if(l.focused&&h){const y=[...t],_=y.length-+i;return y.splice(h-_,_),y.join("")}return G(t,+i)}return t},b=(t,o="onChange")=>{const i=t;t=V(t);const m=p(i)-p(t);if(e.type==="number"||e.type==="digit"){const y=e.type==="number";t=Ne(t,y,y)}let h=0;if(e.formatter&&o===e.formatTrigger){const{formatter:y,maxlength:_}=e;if(t=y(t),k(_)&&p(t)>+_&&(t=G(t,+_)),c.value&&l.focused){const{selectionEnd:L}=c.value,Z=G(i,L);h=p(y(Z))-p(Z)}}if(c.value&&c.value.value!==t)if(l.focused){let{selectionStart:y,selectionEnd:_}=c.value;if(c.value.value=t,k(y)&&k(_)){const L=p(t);m?(y-=m,_-=m):h&&(y+=h,_+=h),c.value.setSelectionRange(Math.min(y,L),Math.min(_,L))}}else c.value.value=t;t!==e.modelValue&&n("update:modelValue",t)},U=t=>{t.target.composing||b(t.target.value)},B=()=>{var t;return(t=c.value)==null?void 0:t.blur()},T=()=>{var t;return(t=c.value)==null?void 0:t.focus()},F=()=>{const t=c.value;e.type==="textarea"&&e.autosize&&t&&ut(t,e.autosize)},ce=t=>{l.focused=!0,n("focus",t),R(F),v("readonly")&&B()},de=t=>{l.focused=!1,b(w(),"onBlur"),n("blur",t),!v("readonly")&&(g("onBlur"),R(F),We())},X=t=>n("clickInput",t),fe=t=>n("clickLeftIcon",t),me=t=>n("clickRightIcon",t),ge=t=>{O(t),n("update:modelValue",""),n("clear",t)},J=C(()=>{if(typeof e.error=="boolean")return e.error;if(f&&f.props.showError&&l.status==="failed")return!0}),he=C(()=>{const t=v("labelWidth"),o=v("labelAlign");if(t&&o!=="top")return{width:ee(t)}}),ve=t=>{t.keyCode===13&&(!(f&&f.props.submitOnEnter)&&e.type!=="textarea"&&O(t),e.type==="search"&&B()),n("keypress",t)},Q=()=>e.id||`${r}-input`,be=()=>l.status,ye=()=>{const t=S("control",[v("inputAlign"),{error:J.value,custom:!!s.input,"min-height":e.type==="textarea"&&!e.autosize}]);if(s.input)return u("div",{class:t,onClick:X},[s.input()]);const o={id:Q(),ref:c,name:e.name,rows:e.rows!==void 0?+e.rows:void 0,class:t,disabled:v("disabled"),readonly:v("readonly"),autofocus:e.autofocus,placeholder:e.placeholder,autocomplete:e.autocomplete,autocapitalize:e.autocapitalize,autocorrect:e.autocorrect,enterkeyhint:e.enterkeyhint,spellcheck:e.spellcheck,"aria-labelledby":e.label?`${r}-label`:void 0,onBlur:de,onFocus:ce,onInput:U,onClick:X,onChange:ae,onKeypress:ve,onCompositionend:ae,onCompositionstart:st};return e.type==="textarea"?u("textarea",o,null):u("input",ie(ct(e.type),o),null)},Ve=()=>{const t=s["left-icon"];if(e.leftIcon||t)return u("div",{class:S("left-icon"),onClick:fe},[t?t():u(j,{name:e.leftIcon,classPrefix:e.iconPrefix},null)])},Se=()=>{const t=s["right-icon"];if(e.rightIcon||t)return u("div",{class:S("right-icon"),onClick:me},[t?t():u(j,{name:e.rightIcon,classPrefix:e.iconPrefix},null)])},_e=()=>{if(e.showWordLimit&&e.maxlength){const t=p(w());return u("div",{class:S("word-limit")},[u("span",{class:S("word-num")},[t]),se("/"),e.maxlength])}},we=()=>{if(f&&f.props.showErrorMessage===!1)return;const t=e.errorMessage||l.validateMessage;if(t){const o=s["error-message"],i=v("errorMessageAlign");return u("div",{class:S("error-message",i)},[o?o({message:t}):t])}},pe=()=>{const t=v("labelWidth"),o=v("labelAlign"),i=v("colon")?":":"";if(s.label)return[s.label(),i];if(e.label)return u("label",{id:`${r}-label`,for:s.input?void 0:Q(),onClick:m=>{O(m),T()},style:o==="top"&&t?{width:ee(t)}:void 0},[e.label+i])},xe=()=>[u("div",{class:S("body")},[ye(),W.value&&u(j,{ref:E,name:e.clearIcon,class:S("clear")},null),Se(),s.button&&u("div",{class:S("button")},[s.button()])]),_e(),we()];return re({blur:B,focus:T,validate:d,formValue:P,resetValidation:I,getValidationStatus:be}),$e(Oe,{customValue:x,resetValidation:I,validateWithTrigger:g}),De(()=>e.modelValue,()=>{b(w()),I(),g("onChange"),R(F)}),qe(()=>{b(w(),e.formatTrigger),R(F)}),ze("touchstart",ge,{target:C(()=>{var t;return(t=E.value)==null?void 0:t.$el})}),()=>{const t=v("disabled"),o=v("labelAlign"),i=Ve(),m=()=>{const h=pe();return o==="top"?[i,h].filter(Boolean):h||[]};return u(Je,{size:e.size,class:S({error:J.value,disabled:t,[`label-${o}`]:o}),center:e.center,border:e.border,isLink:e.isLink,clickable:e.clickable,titleStyle:he.value,valueClass:S("value"),titleClass:[S("label",[o,{required:M.value}]),e.labelClass],arrowDirection:e.arrowDirection},{icon:i&&o!=="top"?()=>i:null,title:m,value:xe,extra:s.extra})}}});const ht=Y(gt),[vt,le]=H("cell-group"),bt={title:String,inset:Boolean,border:K};var yt=N({name:vt,inheritAttrs:!1,props:bt,setup(e,{slots:n,attrs:s}){const r=()=>{var c;return u("div",ie({class:[le({inset:e.inset}),{[je]:e.border&&!e.inset}]},s,Qe()),[(c=n.default)==null?void 0:c.call(n)])},l=()=>u("div",{class:le("title",{inset:e.inset})},[n.title?n.title():e.title]);return()=>e.title||n.title?u(Ue,null,[l(),r()]):r()}});const Vt=Y(yt);const St={class:"md-demo-form-demo-page"},_t=N({__name:"FormDemoPage",setup(e){const n=q({username:"",password:"",phone:"",captcha:"",content:""});return(s,r)=>{const l=ht,c=Ye,E=Vt,x=rt;return Ge(),Ke("div",St,[u(x,null,{default:$(()=>[u(E,{inset:""},{default:$(()=>[u(l,{modelValue:n.value.username,"onUpdate:modelValue":r[0]||(r[0]=f=>n.value.username=f),name:"用户名",label:"用户名",placeholder:"用户名",rules:[{required:!0,message:"请填写用户名"}]},null,8,["modelValue"]),u(l,{modelValue:n.value.password,"onUpdate:modelValue":r[1]||(r[1]=f=>n.value.password=f),type:"password",name:"密码",label:"密码",placeholder:"密码",rules:[{required:!0,message:"请填写密码"}]},null,8,["modelValue"]),u(l,{modelValue:n.value.phone,"onUpdate:modelValue":r[2]||(r[2]=f=>n.value.phone=f),type:"password",name:"手机",label:"手机",placeholder:"手机",rules:[{required:!0,message:"请填写手机"}]},null,8,["modelValue"]),u(l,{modelValue:n.value.captcha,"onUpdate:modelValue":r[3]||(r[3]=f=>n.value.captcha=f),name:"验证码",label:"验证码",placeholder:"验证码",center:"",clearable:"",rules:[{required:!0,message:"请填写验证码"}]},{button:$(()=>[u(c,{size:"small",type:"primary",plain:""},{default:$(()=>[se("发送验证码")]),_:1})]),_:1},8,["modelValue"]),u(l,{modelValue:n.value.content,"onUpdate:modelValue":r[4]||(r[4]=f=>n.value.content=f),type:"textarea",name:"内容",label:"内容",placeholder:"内容",rows:"2",autosize:"",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1})])}}});const Et=He(_t,[["__scopeId","data-v-278dbf08"]]);export{Et as default};
